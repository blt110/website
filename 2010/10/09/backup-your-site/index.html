<!doctype html><html><head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=generator content="Hugo 0.89.3">
<link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css integrity=sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk crossorigin=anonymous>
<link rel=stylesheet href=/css/code_tango.css>
<script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js integrity=sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo crossorigin=anonymous></script>
<script src=https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js integrity=sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI crossorigin=anonymous></script>
<link href=https://cdnjs.cloudflare.com/ajax/libs/fotorama/4.6.4/fotorama.css rel=stylesheet>
<script src=https://cdnjs.cloudflare.com/ajax/libs/fotorama/4.6.4/fotorama.js></script>
<link rel=apple-touch-icon sizes=180x180 href=https://www.scottyob.com/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=https://www.scottyob.com/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=https://www.scottyob.com/favicon-16x16.png>
<link rel=manifest href=https://www.scottyob.com/site.webmanifest>
<link rel=mask-icon href=https://www.scottyob.com/safari-pinned-tab.svg color>
<meta name=msapplication-TileColor content>
<meta name=theme-color content>
<title>Backup your site! | Scott O'Brien</title>
<style>@media(min-width:992px){.container{max-width:1442px}}body{background-color:#fff;background-color:#fff;color:#888;font-size:.66em;font-family:lucida grande,Verdana,Arial,Sans-Serif;line-height:1.4;margin:0;padding:0}.header{margin:4em 0}@media(min-width:768px){#sidebar{text-align:right}}#sidebar{text-transform:lowercase}#sidebar h2{font-family:lucida grande,Verdana,Arial,Sans-Serif;font-size:1.2em;text-transform:uppercase;margin:0;padding:.5em 0 .4em}#sidebar ul{list-style-type:none;margin:0;padding:0}#sidebar li:before{content:"\00BB  "}a{color:#ff7010;text-decoration:none}h1{font-size 3.2em;line-height:1em}h2{font-size:1.8em}h1,h2,h3,h4,h5{font-family:trebuchet ms,lucida grande,Verdana,Arial,Sans-Serif;font-weight:700;line-height:normal;margin:0;padding:0}small{font-size:1em;line-height:1.5em;background-color:inherit;color:#888}h2.pagetitle{background-color:#f0f0f0;color:inherit;padding:.5em 0 .4em .2em;margin:0 0 2em}#content{color:#484848}.leftnav{float:left;margin:0 1em}.rightnav{float:right}.snap-to-fit{clear:both;visibility:hidden}.navigation{margin:0 0 1.6em;padding:0 0 1px;font-family:lucida grande,Arial,Verdana,Sans-Serif;font-size:1.2em}.post{margin:0 0 3em}.post+.post h2{padding:.2em 0 0;border-top:1px solid #888}.entry{width:100%;font-size:1.2em;margin:1em 0 0;overflow:auto}blockquote{margin:1.6em 2.8em 0 1.4em;padding:0 0 0 2em;border-left:.6em solid #ddd}#footer{clear:both;margin:4em 0 1em;padding:.2em 0 0;border-top:1px solid #888;font-family:lucida grande,Arial,Verdana,Sans-Serif}</style>
</head>
<body><div id=navbar-top class=d-md-none>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
<a class=navbar-brand href=/>Posts</a>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarNavAltMarkup aria-controls=navbarNavAltMarkup aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span>
</button>
<div class="collapse navbar-collapse" id=navbarNavAltMarkup>
<div class=navbar-nav>
<a class="nav-item nav-link" href=/page/bucketlist/>The Bucket List</a>
<a class="nav-item nav-link" href=/page/about/>About Me</a>
<a class="nav-item nav-link" href=/recipes/>Recipes</a>
</div>
</div>
</nav>
</div>
<div class=container id=container>
<div class=row>
<div class="col-md-9 offset-md-3">
<div class=header>
<h1><a href=/>Scott O'Brien</a></h1>
<small>Projects, Ramblings and Resources of my (online) life</small>
</div>
</div>
</div>
<div class=row>
<div id=content class=col-md-9>
<style>.entry{font-size:1.2em;margin:1em 0 0}</style>
<div class=navigation>
<div class=leftnav>« <a href=/2010/11/07/a-dawn-of-a-new-scott/>A dawn of a new Scott</a></div>
<div class=rightnav><a href=/2010/10/09/a-new-blog/>A new blog</a> »</div>
<div class=snap-to-fit></div>
</div>
<div class=post>
<h2>Backup your site!</h1>
<small>2010-10-09 14:31:22 +0000 UTC</small>
<div class=entry>
<p>In my previous post I mentioned how I didn’t back up or migrate any of my data before we stopped paying the hosting company, so it’s all lost.</p>
<p>This has me thinking how much of a shame it would be if I build a wealth of information or a blog that I can use to identify myself and my work, only to have it go if the machine it’s hosted on dies. That would be bad, so this post is a short tutorial on how perform nightly backups of your website without you having to lift a finger.
<strong>About</strong><br>This method uses <a href=http://en.wikipedia.org/wiki/Rsync onclick="_gaq.push(['_trackEvent','outbound-article','http://en.wikipedia.org'])" title="About Rsync">rsync</a> to transfer files (including a dump of the database) to another machine so you’ve got a live backup should things turn pear shaped. In this short tutorial, we’ll be transfering files from our ‘<em>webhost</em>‘ server to our <em>backuphost </em>server
<strong>Step 1. SSH RSA KEYS</strong><br>We will be using ssh to transfer, securely, the data between our two hosts. Because this is a scripted and automated method, we can’t be there to type in a password each time we wish to run the backups. So we’ll be using a <a href=http://en.wikipedia.org/wiki/RSA onclick="_gaq.push(['_trackEvent','outbound-article','http://en.wikipedia.org'])">RSA public/private</a> key pair for secure authentication. This will allow us password-less authentication for ssh sessions, transferring files with scp, etc.<br>First, log in to the <em>webhost</em> where we can generate the local public and private keys.</p>
<blockquote style=clear:both>
<p>$ ssh-keygen -t rsa</p>
</blockquote>
<p>This will prompt you for a location to save the key and a passphrase, you can just enter past those and accept all the defaults.</p>
<p>Our next step is to transfer the public key across to our backup server.</p>
<blockquote style=clear:both>
<p>$ ssh-copy-id -i ~/.ssh/id_rsa.pub <a href=mailto:backupUser@backupserver.com>backupUser@backupserver.com</a></p>
</blockquote>
<p>Site Note on using OSX or disto where you don’t have ssh-copy-id.. This will work just as well</p>
<blockquote style=clear:both>
<p>cat ~/.ssh/id_rsa.pub | ssh <a href=mailto:backups@backupserver.com>backups@backupserver.com</a> “cat – &#187; ~/.ssh/authorized_keys”</p>
</blockquote>
<p>This will prompt you for the login password for the host, then copy the <br>keyfile for you, creating the correct directory and fixing the permissions as necessary.</p>
<p>Now test to make sure you can log into the <em>backupserver</em> without requiring a password.</p>
<p><strong>Step 2. Creating the backup script</strong><br>I made a backup script (backup.sh, me sure to ‘chmod u+x backup.sh’ once it’s been created) to run through these few backup procedures. The first step is to do a dump of the database to file. You could very well host an SQL server on the other side and mirror the database to get things up and running faster, but that was overkill for my needs.. Besides, always remember there are many ways to skin a cat and this one seemed to work nice for all intents and purposes.</p>
<p>The backup script has two parts in it, basically do a dump of the database, then copy that over to the server as well as all the public_html or htdocs or where you put your public hosted files.</p>
<div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>echo <span style=color:#a31515>&#34;Running backup script&#34;</span>
echo <span style=color:#a31515>&#34;Running a dump of the database..&#34;</span>
mysqldump user=scottyob password=somePassword all-databases &gt; /var/www/scottyob.com/backup/database.dump <span style=color:green>#backup of database</span>
echo <span style=color:#a31515>&#34;Syncing the backup directory..&#34;</span>
rsync -a -e ssh /var/www/scottyob.com/backup/ backups@backuphost.com:backups/&lt;br /&gt;rsync -a -e ssh /var/www/scottyob.com/htdocs/ backups@backuphost.com:htdocs/
echo <span style=color:#a31515>&#34;Backup made on &#34;</span> <span style=color:#a31515>`</span>date<span style=color:#a31515>`</span> &gt;&gt; /var/www/scottyob.com/backuplog.txt
</code></pre></td></tr></table>
</div>
</div><p>And there you have it, a script to backup your website to a user ‘backups’ on the server ‘backuphost.com’</p>
<p><strong>Step 3. Automated..ness</strong></p>
<p>This is no good for me unless it’s automated. I just ran this script under a <a href=http://www.unixgeeks.org/security/newbie/unix/cron-1.html onclick="_gaq.push(['_trackEvent','outbound-article','http://www.unixgeeks.org'])">cron job</a> to automate this procedure</p>
<p>Edit your cron file using</p>
<blockquote style=clear:both>
<p>$ crontab -e</p>
</blockquote>
<p>Then I told it that at one minute past midnight, it should backup my website every day (add the following line)</p>
<blockquote style=clear:both>
<p>1 0 * * * /var/www/scottyob.com/backup.sh</p>
</blockquote>
<p>And there we have it folks, my backup procedure now so my site will never have to be started from scratch again.</p>
<br class=final-break style=clear:both>
</div>
</div>
<div id=footer>
Made with <a href=https://gohugo.io/>Hugo</a>. Theme half-milk inspired by <a href=http://thortz.com/skimmed-milk/>skimmed-milk</a>
</div>
</div>
<div id=sidebar class="col-md-3 order-md-first d-none d-md-block">
<h2>Other Pages</h2>
<ul>
<li><a href=/page/bucketlist/>The Bucket List</a></li>
<li><a href=/page/about/>About Me</a></li>
<li><a href=/recipes/>Recipes</a></li>
</ul>
</div>
</div>
</div>
</body>
</html>