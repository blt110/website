<!DOCTYPE html>
<html><head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.71.1" />

  

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
  <link rel="stylesheet" href="/css/code_tango.css">
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>


  
  <link rel="apple-touch-icon" sizes="180x180" href="https://www.scottyob.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://www.scottyob.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://www.scottyob.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://www.scottyob.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://www.scottyob.com/safari-pinned-tab.svg" color="">

  <meta name="msapplication-TileColor" content="">

  <meta name="theme-color" content="">

  
  <link rel="stylesheet" href="https://www.scottyob.com/css/bootstrap.min.css" />

  
  <title>Monitoring SRX Chassis Cluster | Scott O&#39;Brien</title>
  

  <style>

  @media (min-width: 992px){
    .container{
      max-width:850px;
    }  
  }

  body {
    background-color: #fff;
    background-color: #fff;
    color: #888;
    font-size: .66em;
    font-family: lucida grande,Verdana,Arial,Sans-Serif;
    line-height: 1.4;
    margin: 0;
    padding: 0;
  }

  .header {
    margin: 4em 0;
  }

  @media (min-width: 768px) {
    #sidebar {
      text-align: right;
    }
  }

  #sidebar {
    text-transform: lowercase;
  }

  #sidebar h2 {
    font-family: lucida grande, Verdana,Arial,Sans-Serif;
    font-size: 1.2em;
    text-transform: uppercase;
    margin: 0;
    padding: .5em 0 .4em;
  }

  #sidebar ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }

  #sidebar li:before {
    content: "\00BB  ";
  }

  a {
    color: #ff7010;
    text-decoration: none;
  }

  h1 {
    font-size 3.2em;
    line-height: 1em;
  }

  h2 {
    font-size: 1.8em;

  }

  h1, h2, h3, h4, h5 {
    font-family: 'Trebuchet MS', 'Lucida Grande', Verdana, Arial, Sans-Serif;
    font-weight: bold;
    line-height: normal;
    margin: 0;
    padding: 0;
  }

  small {
    font-size: 1em;
    line-height: 1.5em;
    background-color: inherit;
    color: #888;
  }

  h2.pagetitle {
    background-color: #f0f0f0;
    color: inherit;
    padding: 0.5em 0 0.4em 0.2em;
    margin: 0 0 2em 0;
  }

  #content {
    color: #484848;
  }

  .leftnav {
    float: left;
    margin: 0 1em 0;
  }

  .rightnav {
    float: right;
  }

  .snap-to-fit {
    clear: both;
    visibility: hidden;
  }

  .navigation {
    margin: 0 0 1.6em 0;
    padding: 0 0 1px 0;
    font-family: 'Lucida Grande', Arial, Verdana, Sans-Serif;
    font-size: 1.2em;
  }

  .post {
    margin: 0 0 3em;
  }

  .post+.post h2 {
      padding: .2em 0 0;
      border-top: 1px solid #888;
  }

  .entry {
    width: 100%;
    font-size: 1.2em;
    margin: 1em 0 0;
    overflow: auto;
  }

  #footer {
    clear: both;
    margin: 4em 0 1em;
    padding: .2em 0 0;
    border-top: 1px solid #888;
    font-family: lucida grande,Arial,Verdana,Sans-Serif;
  }


</style>

</head>

<body><div id="navbar-top" class="d-md-none">
      <nav class="navbar navbar-expand-lg navbar-light bg-light">
	<a class="navbar-brand" href="/">Posts</a>
	<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
	  <span class="navbar-toggler-icon"></span>
	</button>
	<div class="collapse navbar-collapse" id="navbarNavAltMarkup">
	  <div class="navbar-nav">
            
              <a class="nav-item nav-link" href=/page/paragliding/>Paragliding Logbook</a>
            
              <a class="nav-item nav-link" href=/page/bucketlist/>The Bucket List</a>
            
              <a class="nav-item nav-link" href=/page/about/>About Me</a>
            
	  </div>
	</div>
      </nav>
    </div>


    <div class="container" id="container">
      
      <div class="row">
        <div class="col-md-9 offset-md-3">
          <div class="header">
            <h1><a href="/">Scott O&#39;Brien</a></h1>
            <small>Ramblings and resources of my online life</small>
          </div>
        </div> 
      </div>

      <div class="row">
        
        <div id="content" class="col-md-9">
          

<style>
  .entry {
    font-size: 1.2em;
    margin: 1em 0 0 0;
  }

</style>

<div class="navigation">
  
    <div class="leftnav">« <a href="/2012/07/31/zfs-and-apple-time-machine-a-perfect-team/">ZFS and Apple Time Machine, a perfect team</a></div>
  
  
    <div class="rightnav"><a href="/2012/06/03/easily-accessing-geoip-restricted-sites-in-your-network/">Easily accessing GeoIP restricted sites in your network.</a> »</div>
  
  <div class="snap-to-fit"></div>
  
</div>

<div class="post">
  <h2>Monitoring SRX Chassis Cluster</h1>
  <small>2012-07-09 04:44:35 &#43;0000 &#43;0000</small>

  <div class="entry">
    <p>Just finishing off a few things at work this week.  We’ve got a few sites around the place where we have HA internet powered by two Juniper SRX100’s.  The Two SRX100’s operate in a Chassis Cluster and peer with our ISP using BGP across both active/passive devices.</p>
<p><a href="http://www.scottyob.com/wp-content/uploads/2012/07/check_srx_cluster.txt" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://www.scottyob.com']);">This script</a> is a little Nagios check script that I wrote to hook into our in-house Nagios monitoring platform.  It makes sure the chassis cluster has not failed over operating in a degraded state, and makes sure that there are two BGP peers connected.</p>
<p>NOTE:  I was aiming for simplicity in this setup, if you’ve got a bigger environment or require instant notifications you might wish to set up snmp traps to get instant notifications.</p>
<pre><code class="language-#!/bin/bash">
# Bash script to check the status of a SRX cluster.
#  Works by SSHing into cluster to check &quot;show chassis cluster status&quot; command and SNMP walking to make sure BGP peers
#  are both in a connected state

STATE_OK=0
STATE_WARNING=1
STATE_CRITICAL=2
STATE_UNKNOWN=3

clusterAddress=$1
privateKey=$2
clusterStatus=`ssh nagios@$clusterAddress -i $privateKey &quot;show chassis cluster status&quot;`

declare -i primaryCount
declare -i secondaryCount
declare -i failoverCount
declare -i activeBgpPeers

activeBgpPeers=`snmpwalk -Os -c public -v 1 $clusterAddress .1.3.6.1.2.1.15.3.1.2 | grep &quot;INTEGER: 6&quot; | wc -l`
primaryCount=`echo &quot;$clusterStatus&quot; | grep primary | wc -l`
secondaryCount=`echo &quot;$clusterStatus&quot; | grep secondary | wc -l`
failoverCount=`echo &quot;$clusterStatus&quot; | grep &quot;Failover count: 0&quot; | wc -l`

if [ $primaryCount -ne 2 ]
then
        echo &quot;No two primary redundancy groups&quot;
		echo &quot;$clusterStatus&quot;
        exit $STATE_CRITICAL
fi

if [ $secondaryCount -ne 2 ]
then
        echo &quot;No two secondary redundancy groups&quot;
		echo &quot;$clusterStatus&quot;
        exit $STATE_CRITICAL
fi

if [ $failoverCount -ne 2 ]
then
        echo &quot;SRX has fallen over on a redundancy group&quot;
		echo &quot;$clusterStatus&quot;
        exit $STATE_WARNING
fi

if [ $activeBgpPeers -ne 2 ]
then
        echo &quot;NOT 2 Active BGP Peers&quot;
        exit $STATE_CRITICAL
fi

echo &quot;OK, 2 peers.  OK: Chassis Cluster status OK&quot;
echo &quot;$clusterStatus&quot;
exit $STATE_OK
</code></pre>
<p> </p>

  </div>
</div>


<div id="footer">
  Made with <a href="https://gohugo.io/">Hugo</a>.  Theme half-milk inspired by <a href="http://thortz.com/skimmed-milk/">skimmed-milk</a>
</div>
</div>
        <div id="sidebar" class="col-md-3 order-md-first d-none d-md-block">
          
          <h2>Other Pages</h2>
          <ul>
            
              <li><a href=/page/paragliding/>Paragliding Logbook</a></li>
            
              <li><a href=/page/bucketlist/>The Bucket List</a></li>
            
              <li><a href=/page/about/>About Me</a></li>
            
          </ul>
        </div> 
      </div> 
    </div> 
  </body>
</html>
